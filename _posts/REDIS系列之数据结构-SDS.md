
 Redis是一款优秀的key-value数据库，其中存储的键值对都是有对象(Object)组成，可以存储字符串对象、哈希对象、列表对象、集合对象、有序集合对象;由于C语言中没有相关对象的实现，Redis自身扩种底层的数据结构实现上述对象的存储，本文将对REDIS数据库底层的数据结构进行介绍。
 
---

## 1. SDS字符串

Redis并没有直接采用C语言中字符串表示(以空字符结尾的字符数据，一下简称C字符串)，因为C字符串不能够满足数据库的效率性、安全性等多方面考虑，其扩展一种名为简单动态字符串(Simple Dynamic String, SDS)的数据结构，并将SDS作为Redis默认字符串表示。以下将介绍SDS字符串相较于C字符串的优点。

### 1.1 SDS数据结构
```C
typdef sdshdr{

  //记录buff数组中以使用字节的数量
  //相当于sds字符串的长度
  int len;
  //buff中卫使用字节的数量
  int free;
  //字节数组用于保存字符串
  char *buff;
} SDS;
```
图1-1展示一个SDS实例:

---
###1.2 优点

#### 1.2.1 常数时间获取字符串长度

C字符串以‘\0’结尾，获取字符串长度需要遍历数组，其时间复杂度O(N),伪代码如下:  

```
  int cnt = 0;  
  while( *buff++ != '\0'){
     cnt++;
  }
  return cnt;
```
对于SDS字符串来说，’sdshr->len‘即是字符串长度，时间复杂度为O(1).
字符串数据结构是在程序中经常会使用到的数据结构,Redis把字符串长度时间复杂度从O(N)降到O(1),这确保获取字符串长度的工作不会成为Redis的性能瓶颈。

#### 1.2.2 安全性
除了获取字符串的复杂度高之外，C字符串不记录自身长度带来另一个问题是容器造成缓冲区溢出。举个例子,<string.h>/strcat函数可以将src字符串中的内容拼接到dest字符串的末尾:
 `char *strcat(char *dest,char *src) `  
 假如在在内存中有两个C字符串s1="hello"和s2="redis",如图所示  
   
|'h'|'e'|'l'|'l'|'o'|'\0'|'r'|'e'|'d'|'i'|'s'|'\0'|  
|--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
如果程序执行`stcat(s1," world");`将s1的内容修改为`“hello world”`,那么在strcat函数执行之后,s1数据将溢出，s2的数据将被破坏。  
与C字符串不同，SDS自动空间分配策略防止发生缓冲区溢出的可能性;当SDS API需要对SDS进行修改时，API首先检查SDS空间是否满足修改的要求,如果不满足的话，API将进行空间扩展至执行修改所需大小,然后执行拼接,伪代码如下：  

```
  strcat(SDS dest,SDS src){
  
  if(src->len > dest->free){
    //重新分配空间，再复制
  }
  
  
  }

```







